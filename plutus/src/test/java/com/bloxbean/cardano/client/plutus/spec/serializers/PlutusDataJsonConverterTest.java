package com.bloxbean.cardano.client.plutus.spec.serializers;

import co.nstant.in.cbor.model.ByteString;
import com.bloxbean.cardano.client.plutus.spec.PlutusData;
import com.bloxbean.cardano.client.util.HexUtil;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;

class PlutusDataJsonConverterTest {

    @Test
    void serDeser1() throws Exception {
        String datumHex = "d8799fd8799f4040ffd8799f581ca0028f350aaabe0545fdcb56b039bfb08e4bb4d8c4d7c3c7d481c23545484f534b59ff1b000000e449901987181eff";
        PlutusData plutusData = PlutusData.deserialize(HexUtil.decodeHexString(datumHex));

        String json = PlutusDataJsonConverter.toJson(plutusData);
        System.out.println(json);

        PlutusData dePlutusData = PlutusDataJsonConverter.toPlutusData(json);
        assertThat(dePlutusData).isEqualTo(plutusData);
    }

    @Test
    void serDeser2() throws Exception {
        String datumHex = "d8799fd8799fd8799fd8799f581c33163652e747a54b16680371b7b6812d355a1dd1087239bfaf57d2f3ffd8799fd8799fd8799f581c1ee198ba32b1d7abe754cc38075471d7a322b72b624e63e56109fe8effffffff581ca0028f350aaabe0545fdcb56b039bfb08e4bb4d8c4d7c3c7d481c23545484f534b5940401a29d8e284d87a801a00286f90ffff";
        PlutusData plutusData = PlutusData.deserialize(HexUtil.decodeHexString(datumHex));

        String json = PlutusDataJsonConverter.toJson(plutusData);
        System.out.println(json);

        PlutusData dePlutusData = PlutusDataJsonConverter.toPlutusData(json);
        System.out.println(PlutusDataJsonConverter.toJson(dePlutusData));

        String serHex = dePlutusData.serializeToHex();
        assertThat(serHex).isEqualTo(datumHex);

    }

    @Test
    void serDeser_with_map() throws Exception {
        String datumHex = "d8799f581cdf078188aedb870e1161440a90c6c29bc6e9732054a1aa59bd440c2a9fd8799fd8799fd8799f581c1ed92de403227c0fad57b35c8337557234a3863d54294a834b6e95a3ffd8799fd8799fd8799f581cf4627cc3236d1ec8e948ea05b8c8381a2e10ec9a2df4dd2bf6bf084affffffffa140d8799f00a1401a019b3970ffffd8799fd8799fd8799f581c70e60f3b5ea7153e0acc7a803e4401d44b8ed1bae1c7baaad1a62a72ffd8799fd8799fd8799f581c1e78aae7c90cc36d624f7b3bb6d86b52696dc84e490f343eba89005fffffffffa140d8799f00a1401a00a47d60ffffd8799fd8799fd8799f581cdf078188aedb870e1161440a90c6c29bc6e9732054a1aa59bd440c2affd8799fd8799fd8799f581c581d95b6e83eb838560b2d71ee9af38ee347bfe3b577791391525d7effffffffa140d8799f00a1401a1de0c5f0ffffffff";
        PlutusData plutusData = PlutusData.deserialize(HexUtil.decodeHexString(datumHex));

        String json = PlutusDataJsonConverter.toJson(plutusData);
        System.out.println(json);

        PlutusData dePlutusData = PlutusDataJsonConverter.toPlutusData(json);
        System.out.println(PlutusDataJsonConverter.toJson(dePlutusData));

        String serHex = dePlutusData.serializeToHex();
        assertThat(serHex).isEqualTo(datumHex);
    }

    @Test
    void serDeser_largePlutusData() throws Exception {
        String datumHex = "d8799fd8799f40ffd8799fa1d8799fd8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffd8799f4040ffff1a0016e360a0a000ffd87c9f9fd8799fd87a9fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffff9fd8799f011a3b9aca00ffffffd87d9fd8799f45546f74616cffd87c9fd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd87c9f9fd8799fd87a9fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffff9fd8799f011a3b9aca00ffffffd87d9fd8799f45546f74616cffd87c9fd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd87c9f9fd8799fd87a9fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffff9fd8799f011a3b9aca00ffffffd87d9fd8799f45546f74616cffd87c9fd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd87c9f9fd8799fd87a9fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffff9fd8799f011a3b9aca00ffffffd87d9fd8799f45546f74616cffd87c9fd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd87c9f9fd8799fd87a9fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffff9fd8799f011a3b9aca00ffffffd87d9fd8799f45546f74616cffd87c9fd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd87c9f9fd8799fd87a9fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffff9fd8799f011a3b9aca00ffffffd87d9fd8799f45546f74616cffd87c9fd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffd87980ffffd8799fd87a9fd8799f48436f6d706c657465d8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87c9f9fd8799fd8799fd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffd8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffd8799f4040ffd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffffd87980ffd8799fd87a9fd8799f4652656a656374d8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffd8799fd87a9fd8799f4643616e63656cd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffffd8799fd87a9fd8799f48436f6d706c657465d8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87c9f9fd8799fd8799fd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffd8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffd8799f4040ffd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffffd87980ffd8799fd87a9fd8799f4652656a656374d8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffd8799fd87a9fd8799f4643616e63656cd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffffd8799fd87a9fd8799f48436f6d706c657465d8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87c9f9fd8799fd8799fd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffd8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffd8799f4040ffd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffffd87980ffd8799fd87a9fd8799f4652656a656374d8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffd8799fd87a9fd8799f4643616e63656cd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffffd8799fd87a9fd8799f48436f6d706c657465d8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87c9f9fd8799fd8799fd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffd8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffd8799f4040ffd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffffd87980ffd8799fd87a9fd8799f4652656a656374d8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffd8799fd87a9fd8799f4643616e63656cd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffffd8799fd87a9fd8799f48436f6d706c657465d8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87c9f9fd8799fd8799fd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffd8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffd8799f4040ffd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffffd87980ffd8799fd87a9fd8799f4652656a656374d8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffd8799fd87a9fd8799f4643616e63656cd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffffd8799fd87a9fd8799f48436f6d706c657465d8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87c9f9fd8799fd8799fd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffd8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffd8799f4040ffd87c9fd905039fd8799f45546f74616cffffd905009fd8799f474164644c696e65d8799fd87980d8799fd8799f581c0a11b0c7e25dc5d9c63171bdf39d9741b901dc903e12b4e162348e07ffd87a80ffffffffffffd87980ffd8799fd87a9fd8799f4652656a656374d8799fd87980d8799fd8799f581cfd37884bbd044c72e5f29de1b777a9c1c1d531773535cd5b55e2f6ffffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffffd8799fd87a9fd8799f4643616e63656cd8799fd87980d8799fd8799f581ce107572dc2e0f7dadaf87c1a4f55d6b5b5456108c1de8f6d75ba0d15ffd87a80ffffff9fd8799f0000ffffffd87980ffff1b000001852aef1633d87980ffff";
        PlutusData plutusData = PlutusData.deserialize(HexUtil.decodeHexString(datumHex));

        String json = PlutusDataJsonConverter.toJson(plutusData);
        assertThat(plutusData).isNotNull();
        assertThat(json).isNotNull();
    }

    @Test
    void utf8_ByteStringdeserializationTest() throws Exception {
        String datumHex = "d8799fa6446e616d654c54657374313233546f6b656e45696d6167655835697066733a2f2f516d5763636a566279694d6a394637775278725053743554387953687974714331646f5132585072457838485379496d65646961747970654a696d6167652f6a706567496d65646961547970654a696d6167652f6a7065674b6465736372697074696f6e404566696c65739fa3496d65646961747970654a696d6167652f6a706567446e616d654a696d6167652f6a706567437372635835697066733a2f2f516d5763636a566279694d6a394637775278725053743554387953687974714331646f5132585072457838485379ff01ff";
        PlutusData plutusData = PlutusData.deserialize(HexUtil.decodeHexString(datumHex));

        String json = PlutusDataJsonConverter.toUTF8Json(plutusData);
        assertThat(plutusData).isNotNull();
        assertThat(json).isNotNull();
    }
}
