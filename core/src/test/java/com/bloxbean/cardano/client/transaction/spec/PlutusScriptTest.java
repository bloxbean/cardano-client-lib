package com.bloxbean.cardano.client.transaction.spec;

import com.bloxbean.cardano.client.common.cbor.CborSerializationUtil;
import com.bloxbean.cardano.client.util.HexUtil;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.AssertionsForClassTypes.assertThat;
import static org.junit.jupiter.api.Assertions.*;

class PlutusScriptTest {

    @Test
    void deserializeScriptRefBytesPlutusV2() {
        String cbor = "820259106659106301000033233223232332232323232323233222232322323223232533533300a5335333333357480124a66a666ae68cdc3a8042400001a01826a0322444600201a2a66a601c6aae794024540608c8c8c8c8c8854cd400454cd4ccd5cd19b87500f4800805004c54cd4ccccccd5d200391999ab9a3370e6aae7540152000233335573ea00a4a04446666aae7d40149408c8cccd55cf9aba25006253353232323333333574800646666ae68cdc39aab9d5003480008cccd55cfa8019281511999aab9f35744a0084a66a60526ae85401484d40b4004540ac940ac0a40a0940a4080940a0940a0940a0940a00984d55cf280089baa00135742a01042a66a646464646666666ae900108cccd5cd19b875002480008cccd55cfa8021281611999aab9f35744a00a4a66a646464646666666ae900108cccd5cd19b8735573aa008900011999aab9f500425034233335573ea0084a06a46666aae7cd5d128029299a98181aba15007215335303135742a00e426a07224660020060042a06e2a06c4a06c0680660644a0660544a0644a0644a0644a06406026ae8940044d55cf280089baa00135742a00c426a05e6a05e0022a05a4a05a05605446666ae68cdc3a801a400446666aae7d40148d40b940b4940b40ac940b008c088940a8940a8940a8940a80a04d55cea80109aab9e5001137540026ae85402084d409c48cc00400c008540945409094090088084080940840609408094080940809408007884d40844888c0080105407c54cd4ccd5cd19b87500f4801005004c54cd4ccccccd5d200391999ab9a3370e6aae75401d2000233335573ea00e4a04446666aae7cd5d128041299a991919191919191919191999999aba400a23333573466e1cd55cea8052400046666aae7d4028940c08cccd55cfa8051281891999aab9f500a25032233335573ea0144a06646666aae7d4028940d08cccd55cfa8051281a91999aab9f500a25036233335573ea0144a06e46666aae7cd5d128059299a991999999aba40012503a2503a2303537580044a0744a0740706ae85404c854cd4c0ccd5d0a80990a99a981a1aba15013215335303535742a02642a66a606c6ae85404c854cd4c8c8c8ccccccd5d200191999ab9a3370e6aae75400d2000233335573ea0064a08646666aae7cd5d128021299a981f1aba1500521350460011504425044042041250420392504125041250412504103f135573ca00226ea8004d5d0a80990a99a981c1aba15013215335303935742a026426a082246666666600201201000e00c00a0080060042a07e2a07c2a07a2a0782a0762a0742a0722a0704a07006c06a06806606406206005e05c4a05e04c4a05c4a05c4a05c4a05c05826ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea8004d5d0a804909a8128008a811928118108101281080c1281012810128101281000f109a810891118018020a80f8a80f910a81089aba25001135573ca00226ea800c4d55cf280089baa00125018250182501825018016210011326320103357389201154661696c656420746f20706172736520646174756d000163333573466e1d4011200c21222222200423333573466e1d4015200a21222222200223333573466e1d4019200821222222200123333573466e1d401d2006232122222223003008375c6ae84d55cf280491999ab9a3370ea010900210911111100391999ab9a3370ea012900110911111100311999ab9a3370ea014900010911111100291931900b99ab9c01701d01501401301201101000f3333573466e1cd55cea80124000466442466002006004646464646464646464646464646666ae68cdc39aab9d500c480008cccccccccccc88888888888848cccccccccccc00403403002c02802402001c01801401000c008d5d0a8061aba1500b35742a0146ae854024d5d0a8041aba1500735742a00c6ae854014d5d0a8021aba1500335742a0046ae84d5d1280111931900f99ab9c01f02501d135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d55cf280089baa00135742a0046464646666ae68cdc3a800a400c46424444600800a6464646464646666ae68cdc3a800a401842444444400646666ae68cdc3a8012401442444444400846666ae68cdc3a801a40104664424444444660020120106eb8d5d0a8029bad357426ae8940148cccd5cd19b875004480188cc8848888888cc008024020dd71aba15007375c6ae84d5d1280391999ab9a3370ea00a9002119910911111119803004804180f1aba15009375c6ae84d5d1280491999ab9a3370ea00c9001119091111111803804180f9aba135573ca01646666ae68cdc3a803a400046424444444600a01060406ae84d55cf280611931901119ab9c02202802001f01e01d01c01b01a135573aa00826aae79400c4d55cf280109aab9e5001137540026ae84d55cf280191999ab9a3370ea0049002119091111801002980a1aba135573ca00846666ae68cdc3a801a400446424444600200a6464646666ae68cdc39aab9d5002480008cc8848cc00400c008c8c8cccd5cd19b8735573aa002900011bae357426aae7940088c98c8078cd5ce00f01200e09baa00135742a0046eb4d5d09aba2500223263201b33573803604203226aae7940044dd50009aba135573ca00a46666ae68cdc3a8022400046424444600600a6eb8d5d09aab9e500623263201833573803003c02c02a02802626aae7540044dd50009aba135744a004464c6402266ae7004405c03c40584c98c8040cd5ce24810350543500016135573ca00226ea80044d55cea80089baa001135573aa00226ea8004488008488004c8004d5403088cccd55cf80092805119a8049aba10023003357440040084646464646666ae68cdc3a800a4004466644424466600200a0080066eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d4009200023212230020033232323333573466e1d400520022321223001003375c6ae84d55cf280191999ab9a3370ea004900011909118010019bae357426aae7940108c98c8038cd5ce00700a00600589aab9d5001137540026ae84d55cf280311931900499ab9c00900f007006135573aa00626ae8940044d55cf280089baa001499240103505431002333333357480024a0104a0104a01046a0126eb400894020018c8004d5401c88cccd55cf80091a804a8029299a98031aba1002215335300435744006426a01666a00c0040022a0122a01000c22440042442446600200800646666666ae90004940109401094010940108d4014dd70010010900089091180100188910008891918008009119801980100100099919191991191919911919191919191919191911111a800911a8011111111111911129999999a8088999a809119980e00080a280291980a80a00811980a80a0080999a8091181124c466036002a00a46044930999a8091181124c466036002a00a460449309980e009a80210999a809919980e80080aa80311980b00a80891980b00a80889980e009a80209810a4c2a66a66a022eb80044c0712622153350011002221302049888d4008888c888d401c888888888888c8c040004cd40548c8c8cccd5cd19b8735573aa00490001199109198008018011919191999ab9a3370e6aae754009200023322123300100300232323333573466e1cd55cea800a400046eb8d5d09aab9e500223263203033573804806005c26ea8004d5d0a8011bad357426ae8940088c98c80b4cd5ce01081681589aab9e5001137540026ae854008c8c8c8c8c8cccd5cd19b8735573aa00890001199991110919998008028020018011919191999ab9a3370e6aae7540092000233221233001003002302635742a00466a04a4646464646666ae68cdc3a800a4004466644424466600200a0080066eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d400920002321223002003302d357426aae7940188c98c80e8cd5ce01701d01c01b89aab9d5003135744a00226aae7940044dd50009aba135744a004464c6406666ae7009c0cc0c44d55cf280089baa00135742a008666aa040eb8cd54081d73ad35742a0066464646666ae68cdc3a800a4008464244460040086ae84d55cf280191999ab9a3370ea0049001119091118008021bae357426aae7940108cccd5cd19b875003480008488800c8c98c80d4cd5ce01481a81981901889aab9d5001137540026ae854008cd4085d71aba135744a004464c6405e66ae7008c0bc0b44d5d1280089aba25001135573ca00226ea8004d5d09aba2500223263202933573803a05204e26aae7940044dd5000806190009aa80b91299a80089931900c19ab9c491287370656e64696e6741676753746174655554784f3a204d697373696e67206167672073746174652e0001822135002223500122225335333573466e1cd402c88c8c8c00401cc8004d5409088cd400520002235002225335333573466e3c00802409c0984c01c0044c01800cc8004d5408c88cd400520002235002225335333573466e3c00801c09809440044c01800d200201e01d101e1300a0071232230023758002640026aa024446666aae7c004940388cd4034c010d5d080118019aba2002013112232230023756002640026aa02444646666aae7c0089403c8cd4038cc8848cc00400c008c018d55cea80118029aab9e500230043574400602826ae84004488c8c8cccd5cd19b875001480008c8488c00800cc014d5d09aab9e500323333573466e1d40092002212200123263201433573801002802402226aae7540044dd5000919191999ab9a3370ea002900111909118008019bae357426aae79400c8cccd5cd19b875002480008c8488c00800cdd71aba135573ca008464c6402466ae7001804804003c4d55cea80089baa0014910350543100225335333573466e3cd40088800800402c028402c4cd5ce24926636865636b5369676e656442794e6f64653a2057726f6e67206e6f6465206f70657261746f720000a22235003222222223500a2222253353301100f00e1018133355301212001323212330012233350052200200200100235001220011233001225335002101b10010182333573466e3c00403c064060cd404c01403488d4008888894cd4ccd5cd19b8f00500600e00d100e133573892123636865636b5369676e656442794f7261636c653a2057726f6e67206f70657261746f720000d32001355009221122253350011350032200122133350052200230040023335530071200100500400111220021221223300100400323562623263200533573892128496e76616c696420646174756d20666f72207468652070726f76696465642072656465656d65722e0000512200212200149848004448c8c00400488cc00cc008008004cd4488cd4488ccccc00922011c1a550d5f572584e1add125b5712f709ac3b9828ad86581a4759022ba0033550044891c2916eabab07acc90dce7387c0d27372aed852b3999f797a1e51d4c8c0048810a4f7261636c65466565640033550044891c2916eabab07acc90dce7387c0d27372aed852b3999f797a1e51d4c8c0048810841676753746174650033550044891c436941ead56c61dbf9b92b5f566f7d5b9cac08f8c957f28f0bd60d4b0048810c5041594d454e54544f4b454e0033550044891c2916eabab07acc90dce7387c0d27372aed852b3999f797a1e51d4c8c004881084e6f646546656564002222212333330010060050040030022001112212330010030021120011";

        PlutusV2Script plutusV2Script = (PlutusV2Script) PlutusScript.deserializeScriptRefBytes(HexUtil.decodeHexString(cbor));
        assertThat(plutusV2Script.getScriptType()).isEqualTo(2);
        assertThat(plutusV2Script.getScriptTypeBytes()).isNotNull();
    }

//    @Test
    void deserializeScriptRefBytesPlutusV1() throws Exception {
        PlutusV1Script plutusScript = PlutusV1Script.builder()
                .type("PlutusScriptV1")
                .cborHex("590a15590a120100003323322332232323332223233322232333333332222222232333222323333222232323322323332223233322232323322332232323333322222332233223322332233223322223223223232533530333330083333573466e1cd55cea8032400046eb4d5d09aab9e500723504935304a335738921035054310004b499263333573466e1cd55cea8022400046eb4d5d09aab9e500523504935304a3357389201035054310004b499263333573466e1cd55cea8012400046601664646464646464646464646666ae68cdc39aab9d500a480008cccccccccc064cd409c8c8c8cccd5cd19b8735573aa004900011980f981d1aba15002302c357426ae8940088d4164d4c168cd5ce249035054310005b49926135573ca00226ea8004d5d0a80519a8138141aba150093335502e75ca05a6ae854020ccd540b9d728169aba1500733502704335742a00c66a04e66aa0a8098eb4d5d0a8029919191999ab9a3370e6aae754009200023350213232323333573466e1cd55cea80124000466a05266a084eb4d5d0a80118239aba135744a00446a0ba6a60bc66ae712401035054310005f49926135573ca00226ea8004d5d0a8011919191999ab9a3370e6aae7540092000233502733504275a6ae854008c11cd5d09aba2500223505d35305e3357389201035054310005f49926135573ca00226ea8004d5d09aba2500223505935305a3357389201035054310005b49926135573ca00226ea8004d5d0a80219a813bae35742a00666a04e66aa0a8eb88004d5d0a801181c9aba135744a00446a0aa6a60ac66ae71241035054310005749926135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea8004d5d0a8011919191999ab9a3370ea00290031180f181d9aba135573ca00646666ae68cdc3a801240084603a608a6ae84d55cf280211999ab9a3370ea00690011180e98181aba135573ca00a46666ae68cdc3a80224000460406eb8d5d09aab9e50062350503530513357389201035054310005249926499264984d55cea80089baa001357426ae8940088d4124d4c128cd5ce249035054310004b49926104a1350483530493357389201035054350004a4984d55cf280089baa0011375400226ea80048848cc00400c0088004888888888848cccccccccc00402c02802402001c01801401000c00880048848cc00400c008800448848cc00400c0084800448848cc00400c0084800448848cc00400c00848004848888c010014848888c00c014848888c008014848888c004014800448c88c008dd6000990009aa81a111999aab9f0012500e233500d30043574200460066ae880080cc8c8c8c8cccd5cd19b8735573aa006900011998039919191999ab9a3370e6aae754009200023300d303135742a00466a02605a6ae84d5d1280111a81b1a981b99ab9c491035054310003849926135573ca00226ea8004d5d0a801999aa805bae500a35742a00466a01eeb8d5d09aba25002235032353033335738921035054310003449926135744a00226aae7940044dd50009110919980080200180110009109198008018011000899aa800bae75a224464460046eac004c8004d540b888c8cccd55cf80112804919a80419aa81898031aab9d5002300535573ca00460086ae8800c0b84d5d08008891001091091198008020018900089119191999ab9a3370ea002900011a80418029aba135573ca00646666ae68cdc3a801240044a01046a0526a605466ae712401035054310002b499264984d55cea80089baa001121223002003112200112001232323333573466e1cd55cea8012400046600c600e6ae854008dd69aba135744a00446a0466a604866ae71241035054310002549926135573ca00226ea80048848cc00400c00880048c8cccd5cd19b8735573aa002900011bae357426aae7940088d407cd4c080cd5ce24810350543100021499261375400224464646666ae68cdc3a800a40084a00e46666ae68cdc3a8012400446a014600c6ae84d55cf280211999ab9a3370ea00690001280511a8111a981199ab9c490103505431000244992649926135573aa00226ea8004484888c00c0104488800844888004480048c8cccd5cd19b8750014800880188cccd5cd19b8750024800080188d4068d4c06ccd5ce249035054310001c499264984d55ce9baa0011220021220012001232323232323333573466e1d4005200c200b23333573466e1d4009200a200d23333573466e1d400d200823300b375c6ae854014dd69aba135744a00a46666ae68cdc3a8022400c46601a6eb8d5d0a8039bae357426ae89401c8cccd5cd19b875005480108cc048c050d5d0a8049bae357426ae8940248cccd5cd19b875006480088c050c054d5d09aab9e500b23333573466e1d401d2000230133016357426aae7940308d407cd4c080cd5ce2481035054310002149926499264992649926135573aa00826aae79400c4d55cf280109aab9e500113754002424444444600e01044244444446600c012010424444444600a010244444440082444444400644244444446600401201044244444446600201201040024646464646666ae68cdc3a800a400446660106eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d400920002300a300b357426aae7940188d4040d4c044cd5ce2490350543100012499264984d55cea80189aba25001135573ca00226ea80048488c00800c888488ccc00401401000c80048c8c8cccd5cd19b875001480088c018dd71aba135573ca00646666ae68cdc3a80124000460106eb8d5d09aab9e500423500a35300b3357389201035054310000c499264984d55cea80089baa001212230020032122300100320011122232323333573466e1cd55cea80124000466aa016600c6ae854008c014d5d09aba25002235007353008335738921035054310000949926135573ca00226ea8004498480048004448848cc00400c008448004448c8c00400488cc00cc008008004ccc888c8c8ccc888ccc888cccccccc88888888cc88ccccc88888cccc8888cc88cc88cc88ccc888cc88cc88ccc888cc88cc88cc88cc88888cc894cd4c0e4008400440e8ccd40d540d800d205433350355036002481508848cc00400c0088004888888888848cccccccccc00402c02802402001c01801401000c00880048848cc00400c008800488848ccc00401000c00880044488008488488cc00401000c48004448848cc00400c0084480048848cc00400c008800448488c00800c44880044800448848cc00400c0084800448848cc00400c0084800448848cc00400c00848004484888c00c010448880084488800448004848888c010014848888c00c014848888c008014848888c00401480048848cc00400c0088004848888888c01c0208848888888cc018024020848888888c014020488888880104888888800c8848888888cc0080240208848888888cc00402402080048488c00800c888488ccc00401401000c80048488c00800c8488c00400c800448004488ccd5cd19b87002001005004122002122001200101")
                .build();

        byte[] serializedBytes = plutusScript.serialize();
        System.out.println(HexUtil.encodeHexString(serializedBytes));

        PlutusV1Script plutusV1Script = (PlutusV1Script) PlutusScript.deserializeScriptRefBytes(serializedBytes);
        assertThat(plutusV1Script.getScriptType()).isEqualTo(2);
        assertThat(plutusV1Script.getScriptTypeBytes()).isNotNull();
    }
}
