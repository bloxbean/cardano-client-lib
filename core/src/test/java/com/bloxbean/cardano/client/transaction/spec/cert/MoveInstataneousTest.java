package com.bloxbean.cardano.client.transaction.spec.cert;

import co.nstant.in.cbor.model.Array;
import com.bloxbean.cardano.client.transaction.util.CborSerializationUtil;
import com.bloxbean.cardano.client.util.HexUtil;
import org.junit.jupiter.api.Test;

import java.math.BigInteger;

import static org.assertj.core.api.Assertions.assertThat;

class MoveInstataneousTest {

    @Test
    void serDeser() throws Exception {
        String cborHex = "82068201bf8200581c2243de6164f2ab4b6c18975f35cc8d8ce73c176ae2c496fe9b272f0c1b0000000148e6fc6f8200581c2246745ab61b1926777ba6083b643e46f9d6c492fd51a1507a46bf121a019b6aeb8200581c224c90640be35665e803ddca24f763f37ac1a0ec9e767a439da00efc1a01c67c3a8200581c28036c526367fb957efb89cacd3b23ebd99507e3f88976b8d59a774c1a020a239d8200581c2812005e9d39416cceb2b9b0ba58c4a37a0b93ec7de0835d398c8e9a1a00766f968200581c2818b4c59e83079b9454b8942ee4ee78ad7a32b6e57b46d74aad12f31a3e01cba08200581c281c7c0e34322f6af8388e5f3e16eade8a5c122710a82718c3e0dc501a33ece72b8200581c281d78cf4920073b8c7c3127965e1cfcd155637ebca71116766ed3db1a0991783b8200581c282fee90a4e5955bce8073dd92f5ab420109058ef52108b6792a79541a068251038200581c2849756054e63d31ab166f5425ab0deba864f5880666e794f9a548471a00378e138200581c284fdd910725314e5587e24bcc4aea9259fd9eb6c7309db5143fb9ef1a034552188200581c28563405b177a4381736a14d61c1040fa938ce8ec1b77c7e6294d9351a0adb94a08200581c285ed48752686962ff3fdc99b2316cce6c7a8711483903f889cdd05b1a2bbee8548200581c2863dd9cba0e73cf22570f8bb0614bc436dd74034ed79a457ac0ac061ae379ff4d8200581c2869a3d3574dc3d37d8c34fd45640ce39ee425f7c5ebfda9e92670f21a05893c1a8200581c287a2e7454a33903620881db8b0275225f38241d46cf2c055a1bcbb01a001cdc178200581c287e2d363d79a7d14d2c4942fe4a5ef752d7d1eb4204f1607cb823271a002975468200581c288b386bb5c9ab9e30fc992c0e8ef08f2df0b56d3edcd7b0b6b348bf1a2ab62ccc8200581c288ce3aa77e1f9b40bad02259a5f76080786a2f7bea5773e187935101a06b219fc8200581c28a1098a040dc3f2d4e6065b0a8bb40949c2df0b3368f4334815a1bb1a011a1a978200581c28c0060eb0afcd751c43979f817540c84d5f4f0ec020880106c007561a052256b78200581c28db9e3847ae8b7931abd58bf32c81ea0b22dfbc3820a565ce2e7cbf1a0040fd698200581c28dce40ddfcf5565187e8c62ffa1a55fcd9011e5680fd7c0f294aa991a02c89d048200581c28dd3c0f7d855f0557e048aef0fe9b56f19c64e3fcf8bae061c3a5771a04b1821f8200581c28e5aac74b0b7b7ee9a8ae4e7faf2f2695e5fc24912f39a30744072e1a0045d17f8200581c28f635bd86c76059116beb0fbd8d4b551c0180bcdc581aa4a8c12b751a0e562e468200581c29030bc216c5c9c0e76eaf11cece86d2bcab747bb10fc2acdf91c3eb1a002ebb068200581c290da9b77dc4899e2cf79bf42a47492463c052e1d50e27f0b7fa85011a06f55dec8200581c290de9cad9b54bdb0ea5cd302d15ff1b9d43d68ba26656ba00e3e6d41a001cb1778200581c2911433a58a538f1aeba36950a8e01149c92488a2db2d94e779502a51a004d4f8f8200581c29495ce10c06e08cc26dae7b8bd859907be6c064b23a320a40048f211a19cf6f748200581c294b11d5ffa6609cc0ff44d5ba730e6702648ebd9dceb722227af9871a469b67858200581c294cc03d054e8a2c80ecc145b419c92cb1850343b49065296c40f2901a15fd97098200581c2951440ef25e461c47b6acbd58179a35555876cefbdea08c84b8d1f41a025bb92e8200581c2952090620d8ecaf917c454baa025a9dfd010d41fa4a5a5b57c080271a1e5751ac8200581c2952195d57ae9d54e042c772862eef7cef80687dfdb05e0e53cc698c1a02aa968f8200581c29867cac597560de431e1ef19658d2fb3c6d03709fa78c9825da454b1a884915638200581c2986b29b334dac139afa02ccd3262bff22879f22d0bb1f3028104f881a02aacf648200581c298c4bedb7e5f07f2e62c67b6bd586275c7b771b9af85f10d875622d1a01c37d008200581c2997acbc4732852c1d12d093cfce392b025ab7cc7924cce33ea2ce9f1a003b8d0a8200581c299ba71baba185cb720f0dcf6e0fdc49a556175d8db10e94c00b3f471a04ff6df78200581c29a39e6bd74bc530d35e60064daf90ee7771911f272a08813132d0281a001c6a6d8200581c29af02a3c5d67e39dbff2d093063d03e531456923c704a8576b183381a035d4be58200581c29b041363c4737f1bf4d59ed1ec4a5fa268a152d65b913f112e2610c1a01dd049e8200581c29bb5536c48278530b01349928c3cf2dcab040d56c0bf12b8b708c021a003356478200581c29bbd191ecae44bc60bd1b4abdff40a32296d718bce145dbd5332a3c1a01c327c18200581c29bd9202ef3fe82681af06e0f51353236c83b31927afb2b5e67636111a0118a92f8200581c29d1e0761e65244f34ccd96e88066c66493c25d3593451e051f11e5c1a01527dc88200581c29d4169212c72366abb3e46d40b9257deb324d63bdb8ed4d5c4e70e21a099eca1e8200581c29df8f4f9a4175e7d79b56e15dd236bf1f281d32fe7e1487fac4cf5f1a4be97a0a8200581c29dfec3d872e7238c4edcd80d06a7727e50709e4034ea1b0450e74621a021f3a9b8200581c29e852b7760a2704e149099f0d46e5c0bb396267152fc12c86711a861a0f6d10cf8200581c29ebf0fbee514d05fd340485f9f10aa48977047cec9ce6738551b93c1a004ff9898200581c29fe2fe3b14b059c909b92f0f6fe7e66f4e6cb4e68481223ac515e401a01411eb88200581c29ff410f66e820b5691aa9b75846fb5073cfc0b29fdfa7100bc7ba5a1a6d500f598200581c2a00aae7328566f6287cf54d47a8c491937fc40553142b6439f0389f1a394b2e618200581c2a1fbc34e6568de8ddd5477ac4edda8d0f1eb6f11a851469851f62601a037b52598200581c2a2101c5d45c93eecd575f6b0e17f3edfc4b51b617ff0b1d0eaad0431a1361e02e8200581c2a283b823ddd79998351417cde3642ad7ae3df5a0dcf183ea6ca93151a004b7ab38200581c2a28efda8b4a8943fffc4327ea9836c61e1b30b9eaa7667a37d27daf1ad930d3078200581c2a2ab3c4d1868101162d6a59a2c8ed34f60be256c362c1af4a47c50d1a003854fc8200581c2a2ccddc263e8bbdc41c34ee1fbadf759930a3dba3a7a194b91f5b601a001bbfef8200581c2a2fa68e39ba8e2d0256ff3ebb103e67c3627e354058a77c233c84d91a00f9b1328200581c2a37ccde8f4c242f5ece998cb6a8605f69afe36fab480c8cfdfae9d81a003ae28c8200581c2a3a06056baf7a88de8367364c2b036fec54cfb5c1bebe2b1faec6811a00c92f858200581c2a402e68b1934f8655642c88172b947fa813f8c6db4306d93eb778a21a014e7ed18200581c2a5dedff64af9fc223f3c859088ef9a1d1e90069470deafef105d8341a0019f9488200581c2a6e6c2e438a79771e7de30bbc6fcf8149a2e1d94a397aa23cb031261acb3b0bd28200581c2a84a8cb91b31f8fed24f7a333f926d60930378e1aa225a909d4474f1a02e878558200581c2a8b164ae1dcb9ae8070188d655de8648642261d2b63f6d4a894b3281a6b03524a8200581c2a97de3b7b688cfa42036f950d929920541d6e4f688c8dfa499996e81a01a4bdd78200581c2aae5b14ddd74586bd0c9a875b4744cc239260e5803307ef89d5ffbc1a5d93da1e8200581c2ab2afe7617865dd8c986ff1ecf8da602097125e3598825cc01d5c5d1a02340a8e8200581c2ab847c195a6df36ad6dd880ca5ecba2946bc521bab5ff08778f5c131a0b51e7cc8200581c2aba52b873e07db07f9ef04dae89175631d477cd5a9551c9d272da551a024ff51d8200581c2abe77b1bfc4ff1943f906ce8149c93202bcf29cc1c9c50845f17a2e1a01bc29908200581c2ad5c6b42b824a880718d8c399dd343218801efc5c1c6fba51fd699b1a0b309b148200581c2addd1438a5426c1496a4cd0e9e0f0774cc3e32ea1910d16245de5e81a003838918200581c2aeb25fa3502588096a937ffc197f52ab6407b3eeb9b8f7898ffd39d1a00e935758200581c2b0b939e28aaf62af4989915594df50f5aaacebfea98dd2ed9d9ad881a00f440d38200581c2b0f686eb9b14e56805e24c3837841b3e0114aa0d7d6d3294c392b0d1a421f57938200581c2b18f2cfa397036cc63290f17cc834d36f73cc4d2b5c682827f09fc11a01f570158200581c2b1c9409d6c25dea81edc4d021efb79a53f4cc21f4f579e6b982cb721a01189afa8200581c2b2451daf9ab42a8e8c308e6825119048785c2e7a1f01e851741e7311a0079fce48200581c2b271d1b8250c8dfaf3836f79c10a45ca360f81b0497f727902693a41a2b5bd7498200581c2b295a8c27a25da72fa7cfe723310387f927a3c4082a0aa08fa149ec1a003b8d0a8200581c2b36726c81c07cd88f62160ae94a1aacb54dcf945efb2c2cb34303641a4c7cf0588200581c2b377a50c59618737c7c1754e095c214f1a0ee0484aa97cdf219182f1a01955e438200581c2b39d760e476bebcde2d2689113e63c79e9bfadbc033b8ea4a7b4f5d1a00865d3f8200581c2b41574938886a00849c082bab28359cd529469e3ef3ca91506e8d421a0686a5398200581c2b4da0def7877b81c23ca2c092a088c7f39ac7bef655238aba297f741a020a31d38200581c2b602ba32d5d1b5fd1a9dd7978bf898579363f80b3b02bec6162a8961a002221d68200581c2b6b400eab91bf338f1065dfbc91faf763b530e3dce7564dd52afff11a02c2e59b8200581c2b7403e1c80bc54af3a06b7340490ffaf24741d77e95ebb730a832471a006c478c8200581c2b827e93f520744d1f27c21bd980fce1c49929c4ac8405b1255d79041a1182b1748200581c2b88311b9bd646f943898e8a989d70ab312601a050d9f860ca7b30421a01f9446c8200581c2b8ddfe0e6d392eb4f6db637433396ca3054e7f17ea47ac5cc7233d71b00000001355da6748200581c2b8e8aac7a99f4f73acccea6ea177723d84714ae69402d65a33db4cd1a0029ca868200581c2b92abddb8e24312727941c50f3351d052de87398c03d09dc96ab2ea1a06bec1618200581c2b9aafc2469e3fa054c8d445bce82e2bb933611b856b7e9ef13c5ac31a001fcd1b8200581c2b9c0f3797a29c4be21ac4bdffcd48279a46527f0323512c916d4f761b00000001863cad778200581c2bacf3aee3c8859fad2cda4f54c6b66788cfee5f3b7985a2910a26121a002767958200581c2baf9d623d91f0b9f6ed97202d6d6717a537eda06269d9c70a269e011a008ab1758200581c2bbb8fcf008254aace3011e985264094591c24975d51742550b09e161a006bd5e28200581c2bd13fbf31ea42901f6a16a0a333a2c68ea89795ba499a9494c3a7901a00272ec18200581c2be52fd65a3a24928c6a88959ee22c39fb9ab9333d2059d8633130f81a00a68dcf8200581c34279515b588b1ba0f2fc6f4ca163d56450f488227b90af72a84517c1a00e3a8ac8200581c342a9bd2809a0716d12c8f9671677f99c748140454e5203f57114a9a1a00dcb8b08200581c342bcc8710f157d10cb4154bcb65d551801008edaca4e5a4768b77bc1a001aead08200581c34309205b462a00cd33b09f937bf0acd0ec070ebbf3c2adaaf43dbc31a001bf8c38200581c34493870c4d86c7c6712bf2163e83317a0c409c58d5a539d70f59e5d1a001d3f8b8200581c3449980624f0f5c2bf72438bf09a662634058cf62f86e4b5f0c002c51a01159bc08200581c344bd2a26efd0a5306e5fb3273e2ad92a37fd11b42cfd93bd341222d1a006dfffe8200581c344c2f3ec8e29c484e2edf4c349677c5b267ec370b5ea2ce9d3d84821a010a3b238200581c346025623c106cd49c2eaaccc5eefb297e40558039d4057b7e83a8251a0564293f8200581c346b474f201340ccfb96eb370617aa2b108219c2e3c4dbd22d4103cd1a04dd76c08200581c346c875254e53ab536cc8866dbbe2ed71fc5d149a5e209dc0b73dd481a018438088200581c3474dfc79347e68d1e14632c66e6c54121e4c24dbc47c26808ed0bea1a06d9c89c8200581c3480928fad54515abccce6d02e5433f22cdf4e83cf1f64dbbe2a896e1a146d377a8200581c3482dc8e2c078de9f7867d3ceeb6f38150b3290da35c59448d1c61d91aaa09a1a68200581c349c18df4be41fc1eabd792e6ec108c3722e6f05438c00cea5554dd01a00788b7c8200581c34cd6a9e9f2a62038fdfbdbf537e2d70cbf56b0f379e898a1c5cd11b1a00ddff788200581c34da595a4dccb4a9546bc389cc078168c6ced2cc14db2b5ae3833d9a1a003a8d4c8200581c34e87f8df698543c671b0e849585759d9d175b1f1c3dc5d57b2a761f1a018d8af48200581c35025d216cc716ee1240e17d3d91de780ea88a88bb7b13965f23b2fd1a00701be48200581c351be5e3f1f9efa224c29285d4690ec8042cd2e551e38b7648bc47a91a002e73fc8200581c352822e37446a1cd56a4aba7e5dd3d8135624975a128c9d5c4d1764f1a02e3f97f8200581c352938512ca757459767cb5d03113a9c5884aa5f3a2afe215a8008fb1a00874ec78200581c352b2f68a4594d087ec48ad0aa9aa1a0004e80a8a13e734de0b17ed01a001bdc598200581c352e6271e46c1f613700f3be99d31b759afea77f2c0c41430a556d3b1a0ac038258200581c352ea9b21231c57b77bfaecbdc3f8837c3666bfdca2353db75e324a61a48d7c5428200581c35399fa97342f531d3262e534a11d2f4932abbd1093fbf0b3a0a27c41a00a6f1438200581c353e6c69c0b075845d304909cad3a03d22749e656b29af3bfaa672d71a183c2d168200581c354c000914823f3416470c79f279bcd7a8302277727e09898a96564c1a009f64fe8200581c35563a0a801ca0977fc1a8ddc1dcc4dfadc524e0c5eea85a08cef9e11a56dea47e8200581c355e47dfeed514c1619581dd36cfadf5043c03fdfa4d98858c4ec37f1a28212d198200581c355fa59c8ba11afd37d2b414fbc3e4c8442500b99d01a2cbbe0b30151a005abddd8200581c35612fd85d760e9ef21f6cee172cee14d2f7f8ddf6d38474a285baa31b0000000148d2c8c58200581c356a86f30e988e354b0d434d187f48a3e6001c52af688d36a60d0ac21a007d43288200581c356b0959ba1a2b15ac052de06a97c9f6183333f1bea3fa50464a0c521a002ee5a58200581c356f0536044aac11027cf5ac7906391dcba13fee3ed6c59d368455761a004c16fc8200581c357259ad28654fd1456f41e9c903ee6c54aa6865b39d95bb09fb6d0b1a001bbfef8200581c358a8c887be7d955a9e3a20fa416aef0ad589a7aada91211b63e62941a006402938200581c358b8f67a54ca05f29752f67aab532ec797a1ea254572a95341bb4c01a002991b18200581c358f623acad829b0d02cf5dbf0bcd633b05ae7958f7a03eb6b92a6ee1a056bee598200581c359e76b088d9861d24b49c9b28f0389978f7869b817e01f3f785b9e01a004c5e068200581c35aaf52ca44f40f0c56bbcff7ad249bcc8d21e75016bdc89d081e0d81a007f26398200581c35b0fc49013c2dcf9387fb6e35d43f0acf940505f1468ec7e28c80c31a1c0424818200581c35b4d7f7c851006b2875d7c92a4c8a09f2adb6c623a232490544a81a1a006f63308200581c35b56bb52b97de1e262d279883a74460ba701f8a0170c4cfb75f1bd01a1aa371818200581c35b880f04909bd5a71f7a0f35ee09513f5fc2fe529b280895f825d3e1adf2c9c2c8200581c35b9fc8b44f7d0e0ce441b1f3dd261a98e9fbd84f09fff5b572ab05d1a037246788200581c35e4ab5e01142566ae8e801580153cebb0cf349b389b3dbd2bb582d71a0024e83b8200581c35e6c3ebd7057659a8966e6f0d5594daf4693195583954f20c03f78c1a04635d728200581c35eeab052ff3796e785e683ed92ecf2612fde55c10f62330ccdd62531a08d3b7888200581c35fcffca18502ecfc52acc942a7a0f03de99789757ff2c72248e3c381a024e120c8200581c3c3c944c330214ab4ba1cfd67674f2c1c5e5c9c90c45dfac887e4ec01a6c65af868200581c3c5054c04de7f198f79080bf6c03d1fafabc85375db635ae27b766a71a0042609c8200581c3c5a62cf69dfb1848467579e1fe06de092abe6abfe7597b97c7ee49b1aaef06b538200581c3c5cdcff0498ec3bd534d43031dbac4fca2351dd588f8edb74e0d1ec1a00f2fa0b8200581c3c82195b88f1bad2ae7263cebabbb6cfeaae30aa5dfbd8d55d6e087c1a00679e168200581c3c83d456de463840e81a4315810a89824f75d95495f835a3274fcf4c1a00cd67518200581c3c8b04c5bd0d80962cefd2c29f2416e9a39f29a64d0d75ca4d51325c1a011554b68200581c3c9195c57a888fa04961c2fbc5da6c513288be6ede96a628a6b8578b1a3574bab68200581c3c94d5eadd085918e8319f65708c272ea31997a47d1f9b61b03832ed1b00000002a920e2498200581c3c99dc55a107e27d9440e36dcc170f5f5a2915a94da7c7e78c3520471a00be5cfc8200581c3ca70da1c68d9476df5676a97a375b9436d24f30b8ca4a229f08809e1a1516c4838200581c3cab4138ef1ed4adace39c08996cfaa136d6350d298720ca12486cac1a011737c78200581c3cc56a804131424f61f9fb9dc6d8d5ebbf4711fd4a988446d95d853a1a00a862ab8200581c3cc6ea3784eecc03bc736d90e368abb40f873c48d1fc74133afae5a51a1f1c3b308200581c3ccfa857c60ec488eb2ff72d3abc49103b6444418938348af1217c421a0057ccd88200581c3cd4612bf598ff6442a0bd34f4b78edd3335291285e1f1f378cf5b251a01a43df88200581c3cd6ab2f3e5292f361e217c45e00da9466bae4e57123c99b4f43a8801a018d35b58200581c3cd9658dd7b25b6d82eae7fb034080efb67bc7374e69b6fc20b646e31a0063f45e8200581c3cfb1cb7f8e9e83f7dfcdca89153a66cfed0ba72433f680f87d26f151a00b135b88200581c3d02253008c928b1db96b8a969d3d1e9ba1246be29b2b71a6a125a2f1a032d82eb8200581c3d02b5a1abc1f28919c1229a3001bb021e4877122cdb3cd65d63982e1b00000001863b116f8200581c3d0510f07b21d8fb73ec8c71b778c9930efc9a871bf82c7c080afd1b1a04de68498200581c3d18e20598d428a4113422de3c2b7b7bf9fd8e96fda2810e038529ee1a0029e6f08200581c3d2b6299231646386e4c278c5e5cbc2761fb030a86799a7bf76dd8ea1a001c86d88200581c3d2f94b22f1db09490b001c5134b2479645b5ea17fa4d1875916e9201a011cb65c8200581c3d53936b390b70cd632641681c169e3ec2ccd92936c2a0eef5c621291a059cfe1a8200581c3d5c8d8906630588a1af7f9b2a8b1ee04c83ed668dd0dfbdf4240aed1a0053dc168200581c3d722ceefc5742a436f0747e5fce393180a6ee9371b75ea34dbd3d9d1a01910a0c8200581c3d886ef6cb4583003b085c1b5239e6a33173590dea025e0f6809ad3f1a32dee5e48200581c3d9220793da0b2365ece988bdde0107a0f132af7a8f2470d71881f6f1a0ee916808200581c3d95895efa1026696ba9e9b9dcd563c55bcd5cc240aa406dcda972811a04625db48200581c3d9f9c76aa4713c0fc08b69bc49c5bc4c8610b62e4b61b1efa2514e21a00ef09498200581c3da1e0083ef319df501eef693a9d83ae6dad94c31ff5059d967c6b0b1a0589d8638200581c3dc243b34d314b6165aebdf331e89d2a548a4f3d40e3ed57b67970bf1a04881b0d8200581c3dc3e331957d6f51d0e922d1d07fe4dce570c2801acc6cb702c63fbb1a068c6ad88200581c3dca24b20fe6c102f5d2575cc3692e120dd0ebe3874e2a87d76a86881a002521108200581c3dd1b183fc82fda2ff46d4bb1ef67eb3add479833f407604eb341e981a007ba7208200581c3dd36e057dc6d4ba4b8c6fd2d41e5703a2709f3a3c31e7c2f5e4614b1a014464fc8200581c3dd649aa91676a5f7684a58a5f951f54b8cc77a76ef822fc5ecb40991a003854fc8200581c3dd7bbc857761bb99c1532557f03729e22e72fde5a51d350219768941a002b1f838200581c3ddcc7624e02700b0e75abca54d4c77a116f392b1f5290b3830624e51a0041c4528200581c3ddf307bfdbf9f530faff6f37f3dc861d20f1a096a67f39f7f2815001a003ce2078200581c3de20d525171212e8bcea4600ed5b18f8f5fbf4f89a6413f038ca2fd1a0088c02f8200581c3df6a40502e67183e0a41346ed2c0d4bdcf4cbcd6df2c822d20ca46e1a107959a4ff";

        MoveInstataneous moveInstataneous = MoveInstataneous.deserialize((Array) CborSerializationUtil.deserialize(HexUtil.decodeHexString(cborHex)));
        byte[] serBytes = CborSerializationUtil.serialize(moveInstataneous.serialize(), false);


        MoveInstataneous deMoveInst = MoveInstataneous.deserialize((Array) CborSerializationUtil.deserialize(serBytes));

        String doubleSerHex = HexUtil.encodeHexString(CborSerializationUtil.serialize(deMoveInst.serialize(), false)); //canonical false to maintain original order

        assertThat(doubleSerHex).isEqualTo(cborHex);
        assertThat(deMoveInst.getPot()).isEqualTo(MirPot.TREASURY);
        assertThat(deMoveInst.getStakeCredentialCoinMap()).hasSize(200);
        assertThat(deMoveInst.getStakeCredentialCoinMap()
                .get(StakeCredential.fromKeyHash(HexUtil.decodeHexString("2243de6164f2ab4b6c18975f35cc8d8ce73c176ae2c496fe9b272f0c")))).isEqualTo(BigInteger.valueOf(5518064751L));
        assertThat(deMoveInst.getStakeCredentialCoinMap()
                .get(StakeCredential.fromKeyHash(HexUtil.decodeHexString("28036c526367fb957efb89cacd3b23ebd99507e3f88976b8d59a774c")))).isNotNull();
    }

}
