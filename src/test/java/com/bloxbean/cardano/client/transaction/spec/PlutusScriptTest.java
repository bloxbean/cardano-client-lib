package com.bloxbean.cardano.client.transaction.spec;

import co.nstant.in.cbor.model.ByteString;
import com.bloxbean.cardano.client.exception.CborDeserializationException;
import com.bloxbean.cardano.client.exception.CborSerializationException;
import com.bloxbean.cardano.client.util.HexUtil;
import org.junit.jupiter.api.Test;

import static org.assertj.core.api.Assertions.assertThat;

public class PlutusScriptTest {

    @Test
    void serializeDeserializePlutusScript() throws CborSerializationException, CborDeserializationException {
        PlutusScript plutusScript = PlutusScript.builder()
                .type("PlutusScriptV1")
                .cborHex("4e4d01000033222220051200120011")
                .build();

        byte[] bytes = plutusScript.serialize();
        System.out.println("Bytes: " + HexUtil.encodeHexString(bytes));

        ByteString bs = plutusScript.serializeAsDataItem();
        System.out.println("Bytes from Bytestring: " + HexUtil.encodeHexString(bs.getBytes()));

        PlutusScript deSerPlutusScript = PlutusScript.deserialize(bs);

        assertThat(deSerPlutusScript).isEqualTo(plutusScript);
    }

    @Test
    void getPolicyIdAnyOneCanMint() throws CborSerializationException {
        PlutusScript plutusScript = PlutusScript.builder()
                .type("PlutusScriptV1")
                .cborHex("59083159082e010000323322332232323233322232333222323333333322222222323332223233332222323233223233322232333222323233223322323233333222223322332233223322332233222232325335302f332203330430043333573466e1cd55cea8012400046600e64646464646464646464646666ae68cdc39aab9d500a480008cccccccccc054cd408c8c8c8cccd5cd19b8735573aa004900011980d981b1aba150023028357426ae8940088d4158d4c15ccd5ce249035054310005849926135573ca00226ea8004d5d0a80519a8118121aba150093335502a75ca0526ae854020ccd540a9d728149aba1500733502303f35742a00c66a04666aa0a2090eb4d5d0a8029919191999ab9a3370e6aae7540092000233501d3232323333573466e1cd55cea80124000466a04a66a07ceb4d5d0a80118219aba135744a00446a0b46a60b666ae712401035054310005c49926135573ca00226ea8004d5d0a8011919191999ab9a3370e6aae7540092000233502333503e75a6ae854008c10cd5d09aba2500223505a35305b3357389201035054310005c49926135573ca00226ea8004d5d09aba250022350563530573357389201035054310005849926135573ca00226ea8004d5d0a80219a811bae35742a00666a04666aa0a2eb8140d5d0a801181a9aba135744a00446a0a46a60a666ae712401035054310005449926135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea8004d5d0a8011919191999ab9a3370ea00290031180d181b9aba135573ca00646666ae68cdc3a801240084603260826ae84d55cf280211999ab9a3370ea00690011180c98161aba135573ca00a46666ae68cdc3a80224000460386eb8d5d09aab9e500623504d35304e3357389201035054310004f49926499264984d55cea80089baa001357426ae8940088d4118d4c11ccd5ce2490350543100048499261047135045353046335738920103505435000474984d55cf280089baa0012212330010030022001222222222212333333333300100b00a00900800700600500400300220012212330010030022001122123300100300212001122123300100300212001122123300100300212001212222300400521222230030052122223002005212222300100520011232230023758002640026aa06a446666aae7c004940388cd4034c010d5d080118019aba200203423232323333573466e1cd55cea801a4000466600e6464646666ae68cdc39aab9d5002480008cc034c0c4d5d0a80119a8098169aba135744a00446a06e6a607066ae712401035054310003949926135573ca00226ea8004d5d0a801999aa805bae500a35742a00466a01eeb8d5d09aba25002235033353034335738921035054310003549926135744a00226aae7940044dd50009110919980080200180110009109198008018011000899aa800bae75a224464460046eac004c8004d540bc88c8cccd55cf80112804919a80419aa81918031aab9d5002300535573ca00460086ae8800c0bc4d5d08008891001091091198008020018900089119191999ab9a3370ea002900011a80418029aba135573ca00646666ae68cdc3a801240044a01046a0546a605666ae712401035054310002c499264984d55cea80089baa001121223002003112200112001232323333573466e1cd55cea8012400046600c600e6ae854008dd69aba135744a00446a0486a604a66ae71241035054310002649926135573ca00226ea80048848cc00400c00880048c8cccd5cd19b8735573aa002900011bae357426aae7940088d4080d4c084cd5ce24810350543100022499261375400224464646666ae68cdc3a800a40084a00e46666ae68cdc3a8012400446a014600c6ae84d55cf280211999ab9a3370ea00690001280511a8119a981219ab9c490103505431000254992649926135573aa00226ea8004484888c00c0104488800844888004480048c8cccd5cd19b8750014800880188cccd5cd19b8750024800080188d406cd4c070cd5ce249035054310001d499264984d55ce9baa0011220021220012001232323232323333573466e1d4005200c200b23333573466e1d4009200a200d23333573466e1d400d200823300b375c6ae854014dd69aba135744a00a46666ae68cdc3a8022400c46601a6eb8d5d0a8039bae357426ae89401c8cccd5cd19b875005480108cc048c050d5d0a8049bae357426ae8940248cccd5cd19b875006480088c050c054d5d09aab9e500b23333573466e1d401d2000230133016357426aae7940308d4080d4c084cd5ce2481035054310002249926499264992649926135573aa00826aae79400c4d55cf280109aab9e500113754002424444444600e01044244444446600c012010424444444600a010244444440082444444400644244444446600401201044244444446600201201040024646464646666ae68cdc3a800a400446660106eb4d5d0a8021bad35742a0066eb4d5d09aba2500323333573466e1d400920002300a300b357426aae7940188d4044d4c048cd5ce2490350543100013499264984d55cea80189aba25001135573ca00226ea80048488c00800c888488ccc00401401000c80048c8c8cccd5cd19b875001480088c018dd71aba135573ca00646666ae68cdc3a80124000460106eb8d5d09aab9e500423500b35300c3357389201035054310000d499264984d55cea80089baa0012122300200321223001003200120011122232323333573466e1cd55cea80124000466aa016600c6ae854008c014d5d09aba25002235007353008335738921035054310000949926135573ca00226ea8004498480048004448848cc00400c008448004448c8c00400488cc00cc0080080041")
                .build();

        String policyId = plutusScript.getPolicyId();

        assertThat(policyId).isEqualTo("58e4abca68b2f61f8ec0a930016ab0817dfdc0d5183587f10fa501fb");

    }

    @Test
    void getPolicyIdAlwaysSuccessful() throws CborSerializationException {
        PlutusScript plutusScript = PlutusScript.builder()
                .type("PlutusScriptV1")
                .cborHex("4e4d01000033222220051200120011")
                .build();

        String policyId = plutusScript.getPolicyId();
        assertThat(policyId).isEqualTo("67f33146617a5e61936081db3b2117cbf59bd2123748f58ac9678656");
    }

    @Test
    void getPolicyIdHello() throws CborSerializationException {
        PlutusScript plutusScript = PlutusScript.builder()
                .type("PlutusScriptV1")
                .cborHex("5909aa5909a70100003323232332233223332223232323332223332223333333322222222332233333222223333222233322233223322332233322233223322332233223322323232323232323232323232323232323232323232323232335500175c09022444444600e666008600c006600a00460100024a66a6056002209c26a0906a609a66ae712410250640004e4988c8c8c8c8c8c8cccd5cd19b8735573aa00a90001280112803a4c26603aa002a0042600c6ae8540084c050d5d09aba25001135573ca00226ea80084d411d262323232323232323232323232323232323232323232323333573466e1cd55cea80aa40004a0044a02e93099999999998172800a8012801a8022802a8032803a8042804a805099a81080b1aba15012133502001635742a0202666aa032eb94060d5d0a8070999aa80c3ae501735742a018266a03a0426ae8540284cd4070cd54078085d69aba15008133501675a6ae8540184cd4069d71aba150041335019335501b75c0346ae8540084c080d5d09aba25001135744a00226ae8940044d5d1280089aba25001135744a00226ae8940044d5d1280089aba25001135573ca00226ea80084d41192623232323232323333573466e1cd55cea802a40004a0044a00e9309980fa800a8010980b9aba1500213005357426ae8940044d55cf280089baa0021350454988c8c8c8c8c8c8c8c8cccd5cd19b8735573aa00e90001280112804a4c2666044a002a004a006260106ae8540104ccd54029d728049aba15002133500775c6ae84d5d1280089aba25001135573ca00226ea80084d41112623232323232323333573466e1cd55cea802a40004a0044a00e93099810a800a8010980a1aba150021335005012357426ae8940044d55cf280089baa002135043498488c8c8c8c8c8c8cccd5cd19b87500448000940089401126135024500113006357426aae79400c4cccd5cd19b87500148008940889401126135573aa00226ea80084d410d261335500175ceb444888c8c8c004dd58019a80090008918009aa82611191919191919191999aab9f0085504d25300212001052350022200135001220023555505312223300321300a357440124266a0a0a00aa600624002266aa0a0a002a004260106aae7540084c018d55cf280089aba10011223232323232323333573466e1cd55cea802a40004a0044a00e93099a811a800a801099a8038031aba150021335007005357426ae8940044d55cf280089baa002135040498488c8c8c8c8c8c8cccd5cd19b8735573aa00a90001280112803a4c266a04ca002a004266a01000c6ae8540084c020d5d09aba25001135573ca00226ea80084d40fd261223232323232323333573466e1cd55cea802a40004a0044a00e93099a811a800a801099a8038031aba1500213007357426ae8940044d55cf280089baa00213503e498488c8c8c8c8c8c8c8cccd5cd19b87500548010940b0940092613333573466e1d4011200225002250044984d40ad40044c018d5d09aab9e500313333573466e1d4005200025029250044984d55cea80089baa00213503d4988c8c8c8cccd5cd19b875002480088090940092613333573466e1d400520002022250034984d55ce9baa00213503b498488c8c8c004dd60019a80090008918009aa822911999aab9f00125043233504230063574200460066ae88008110800444888c8c8c8c8c8c8cccd5cd19b8735573aa00a90001280112803a4c266aa08ea002a0042600e6ae8540084c014d5d09aba25001135573ca00226ea80084d40e926232323232323232323232323232323333573466e1d4029200625002250044984c0c940044c038d5d09aab9e500b13333573466e1d401d200425002250044984c0b540044c030d5d09aab9e500813333573466e1d4011200225002250044984c0a540044c02cd5d09aab9e500513333573466e1d4005200025003250064984d55cea80189813a80089bae357426aae7940044dd500109a81ba4c4646464646464646464646464646464646464646464646464646666ae68cdc3a80aa401840884a0049309999ab9a3370ea028900510221280124c26666ae68cdc3a809a40104a0044a00c9309981f2800a80109bae35742a00426eb4d5d09aba25001135573ca02426666ae68cdc3a8072400c4a0044a00c9309981d2800a80109bae35742a00426eb8d5d09aba25001135573ca01a26666ae68cdc3a804a40084a0044a00c9309981ca800a801098069aba150021375c6ae84d5d1280089aab9e500813333573466e1d4011200225002250044984c0d540044c020d5d09aab9e500513333573466e1d4005200025003250064984d55cea80189817a800898021aba135573ca00226ea80084d40d92623232323232323232323232323333573466e1d4021200225002250084984ccc0e940054009400c4dd69aba150041375a6ae8540084dd69aba135744a00226ae8940044d55cf280289999ab9a3370ea0029000128019280324c26aae75400c4c0cd40044c010d5d09aab9e50011375400426a06a93119191919191919191999ab9a3370ea0089001128011280224c26070a00226eb8d5d09aab9e500513333573466e1d4005200025003250064984d55cea8018981aa80089bae357426aae7940044dd500109a81a24c46464646464646666ae68cdc39aab9d500548000940089401d26133028500150021300635742a00426eb4d5d09aba25001135573ca00226ea80084d40cd2623232323333573466e1cd55cea801240004a0044a0089309bae357426aae7940044dd500109a81924c4424660020060044002444444444424666666666600201601401201000e00c00a00800600440024424660020060044002444246660020080060044002442466002006004400224244600400622440022400224424660020060042400224424660020060042400224424660020060042400224400424400240022424446006008224440042244400224002424444600800a424444600600a424444600400a424444600200a40024424660020060044002424444444600e01044244444446600c012010424444444600a010244444440082444444400644244444446600401201044244444446600201201040024244600400644424466600200a0080064002424460040064244600200640024646666ae68cdc39aab9d3754004900010051280124c26a0049309308928020891001091091198008020018900089000900088910919800801801089000889191800800911980198010010008888919a8011091980091a80191180100191a80191180080180089191918008009119801980100100091091a9802091a98020019a80180080099999111919191111199a80380280200191199ab9a3371e00400200e00c400224002244004244002400291010c48656c6c6f20576f726c64210001")
                .build();

        String policyId = plutusScript.getPolicyId();
        assertThat(policyId).isEqualTo("396c6cf112a57e057331bd72a9de740a9431d9f10a4bd0fd932472e7");
    }
}
